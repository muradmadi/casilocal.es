---
import "../styles/global.css";

interface Props {
	title?: string;
	description?: string;
	image?: string; 
    type?: 'website' | 'article';
    schema?: object;
}

const { 
	title = "CasiLocal", 
	description = "The curated guide to Madrid's best spots for digital nomads.",
	image = "/og-default.jpg",
    type = "website",
    schema
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const fullTitle = title === "CasiLocal" ? title : `${title} | CasiLocal`;
import Masthead from '../components/Masthead.astro';
import Footer from '../components/Footer.astro';
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/png" href="/favicons/favicon-96x96.png" sizes="96x96" />
		<link rel="icon" type="image/svg+xml" href="/favicons/favicon.svg" />
		<link rel="shortcut icon" href="/favicons/favicon.ico" />
		<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png" />
		<meta name="apple-mobile-web-app-title" content="CasiLocal" />
		<link rel="manifest" href="/favicons/site.webmanifest" />
		<meta name="generator" content={Astro.generator} />
        <link rel="canonical" href={canonicalURL} />
        <link rel="sitemap" href="/sitemap-index.xml" />
        <meta name="msvalidate.01" content="25AB5712C7485858CCAADBA8E9243E96" />

        <!-- SEO -->
		<title>{fullTitle}</title>
        <meta name="description" content={description} />
        
        <!-- Open Graph -->
        <meta property="og:type" content={type} />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={fullTitle} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={new URL(image, Astro.url)} />
        
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content={canonicalURL} />
        <meta property="twitter:title" content={fullTitle} />
        <meta property="twitter:description" content={description} />
        <meta property="twitter:image" content={new URL(image, Astro.url)} />

        <!-- JSON-LD Schema -->
        {schema && <script type="application/ld+json" set:html={JSON.stringify(schema)} />}

        <!-- Ahrefs Analytics -->
        <script 
            type="text/plain" 
            data-category="analytics" 
            src="https://analytics.ahrefs.com/analytics.js" 
            data-key="HV2kKI+2PHOXED9WDhkJxw" 
            async 
        ></script>
	</head>
	<body>
        <Masthead />
		<slot />
        <Footer />
        <script>
            import 'vanilla-cookieconsent/dist/cookieconsent.css';
            import * as CookieConsent from 'vanilla-cookieconsent';
            
            CookieConsent.run({
                guiOptions: {
                    consentModal: {
                        layout: 'box',
                        position: 'bottom right',
                        equalWeightButtons: true,
                        flipButtons: false
                    },
                    preferencesModal: {
                        layout: 'box',
                        position: 'right',
                        equalWeightButtons: true,
                        flipButtons: false
                    }
                },
                categories: {
                    necessary: {
                        readOnly: true
                    },
                    analytics: {
                        enabled: true // Default to enabled for better UX, user can disable
                    }
                },
                language: {
                    default: 'en',
                    translations: {
                        en: {
                            consentModal: {
                                title: 'Protocol Check',
                                description: 'We use cookies to analyze traffic and maintain the index. No personal data is sold.',
                                acceptAllBtn: 'Acknowledge',
                                acceptNecessaryBtn: 'Reject All',
                                showPreferencesBtn: 'Preferences',
                                footer: '<a href="/privacy">Privacy Policy</a>\n<a href="/terms">Terms</a>'
                            },
                            preferencesModal: {
                                title: 'Consent Preferences',
                                acceptAllBtn: 'Save & Accept All',
                                acceptNecessaryBtn: 'Reject All',
                                savePreferencesBtn: 'Save Preferences',
                                closeIconLabel: 'Close',
                                sections: [
                                    {
                                        title: 'Cookie Usage',
                                        description: 'We use cookies strictly for functional operations and anonymous analytics.'
                                    },
                                    {
                                        title: 'Strictly Necessary',
                                        description: 'Required for the site to function.',
                                        linkedCategory: 'necessary'
                                    },
                                    {
                                        title: 'Analytics',
                                        description: 'Helps us identify popular spots and improve the index.',
                                        linkedCategory: 'analytics'
                                    }
                                ]
                            }
                        }
                    }
                }
            });
        </script>
	</body>
</html>
