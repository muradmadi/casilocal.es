---
---
<section class="py-24 px-4 lg:px-6 bg-bg-main relative overflow-hidden" id="submit-spot">
    
    <!-- Decorative background elements could go here -->

    <div class="max-w-3xl mx-auto space-y-12">
        
        <header class="text-center space-y-4">
            <h2 class="font-display font-black text-4xl md:text-6xl text-text-main tracking-tight">
                Know a Hidden Gem?
            </h2>
            <p class="font-body text-xl text-text-main/70 leading-relaxed max-w-lg mx-auto">
                We accept spaces that honor both the work and the coffee. No chains. No libraries. Just hidden gems.
            </p>
        </header>

        <!-- Success Message -->
        <div id="success-message" class="hidden text-center space-y-8 py-12 border-2 border-dotted border-line rounded-sm bg-text-main/[0.02]">
            <div class="flex justify-center">
                <div class="p-6 border-2 border-text-main rounded-full bg-text-main text-bg-main">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                </div>
            </div>
            <div class="space-y-2">
                <h3 class="font-display font-black text-4xl tracking-tighter text-text-main">Received</h3>
                <p class="font-body text-lg text-text-main/80 max-w-md mx-auto">
                    Your transmission has been logged. Our curators will verify the data within 48 hours.
                </p>
            </div>
            <button id="reset-button" type="button" class="btn-primary px-8 py-3 text-sm">
                Submit Another
            </button>
        </div>

        <!-- The Main Form -->
        <form id="submit-form" action="https://api.web3forms.com/submit" method="POST" class="space-y-12 border-2 border-dotted border-line p-8 md:p-12 rounded-sm bg-text-main/[0.02]">
             <input type="hidden" name="access_key" value={import.meta.env.PUBLIC_WEB3FORMS_ACCESS_KEY}>
             
            <!-- 1. Google Maps Link -->
            <div class="space-y-4">
                <label for="maps-link" class="block font-mono text-xs font-bold uppercase tracking-widest text-text-main/60">
                    01. Google Maps Link
                </label>
                <div class="relative group">
                    <input 
                        type="url" 
                        id="maps-link" 
                        name="maps-link"
                        placeholder="Paste URL here..."
                        class="w-full bg-transparent border-b-2 border-line-heavy py-3 text-lg md:text-xl font-body text-text-main placeholder:text-text-main/20 focus:outline-none focus:border-action transition-colors"
                        required
                    />
                    <div class="absolute right-0 top-1/2 -translate-y-1/2 text-action opacity-0 transition-opacity duration-300 pointer-events-none" id="link-valid-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </div>
                </div>
            </div>

            <!-- 2. The Assessment -->
            <div class="space-y-8">
                <div class="flex items-baseline justify-between border-b-2 border-dotted border-line-heavy/30 pb-2">
                     <span class="font-mono text-xs font-bold uppercase tracking-widest text-text-main/60">02. Assessment</span>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- WiFi -->
                    <fieldset class="space-y-3">
                        <legend class="font-display font-bold text-text-main mb-2">WiFi Performance</legend>
                        <div class="grid grid-cols-2 gap-2">
                            {['Flynet', 'Reliable', 'Spotty', 'Detox'].map((option) => (
                                <label class="cursor-pointer relative">
                                    <input type="radio" name="wifi" value={option.toLowerCase()} class="peer sr-only" />
                                    <span class="block text-center py-2 px-2 border border-line rounded-xs font-mono text-xs text-text-main/70 transition-all 
                                        peer-checked:bg-text-main peer-checked:text-bg-main peer-checked:border-text-main
                                        hover:border-text-main">
                                        {option}
                                    </span>
                                </label>
                            ))}
                        </div>
                    </fieldset>

                    <!-- Noise -->
                    <fieldset class="space-y-3">
                        <legend class="font-display font-bold text-text-main mb-2">Acoustics</legend>
                        <div class="grid grid-cols-3 gap-2">
                             {['Silence', 'Hum', 'Chaos'].map((option) => (
                                <label class="cursor-pointer relative">
                                    <input type="radio" name="noise" value={option.toLowerCase()} class="peer sr-only" />
                                    <span class="block text-center py-2 px-2 border border-line rounded-xs font-mono text-xs text-text-main/70 transition-all 
                                        peer-checked:bg-text-main peer-checked:text-bg-main peer-checked:border-text-main
                                        hover:border-text-main">
                                        {option}
                                    </span>
                                </label>
                            ))}
                        </div>
                    </fieldset>

                    <!-- Power -->
                    <fieldset class="space-y-3">
                        <legend class="font-display font-bold text-text-main mb-2">Power Access</legend>
                        <div class="grid grid-cols-3 gap-2">
                             {['Abundant', 'Scarce', 'None'].map((option) => (
                                <label class="cursor-pointer relative">
                                    <input type="radio" name="power" value={option.toLowerCase()} class="peer sr-only" />
                                    <span class="block text-center py-2 px-2 border border-line rounded-xs font-mono text-xs text-text-main/70 transition-all 
                                        peer-checked:bg-text-main peer-checked:text-bg-main peer-checked:border-text-main
                                        hover:border-text-main">
                                        {option}
                                    </span>
                                </label>
                            ))}
                        </div>
                    </fieldset>

                     <!-- Coffee -->
                    <fieldset class="space-y-3">
                        <legend class="font-display font-bold text-text-main mb-2">Coffee Quality</legend>
                        <div class="grid grid-cols-3 gap-2">
                             {['Great', 'Standard', 'Bad'].map((option) => (
                                <label class="cursor-pointer relative">
                                    <input type="radio" name="coffee" value={option.toLowerCase()} class="peer sr-only" />
                                    <span class="block text-center py-2 px-2 border border-line rounded-xs font-mono text-xs text-text-main/70 transition-all 
                                        peer-checked:bg-text-main peer-checked:text-bg-main peer-checked:border-text-main
                                        hover:border-text-main">
                                        {option}
                                    </span>
                                </label>
                            ))}
                        </div>
                    </fieldset>
                </div>
            </div>

            <!-- 3. Briefing -->
            <div class="space-y-4">
                <label for="review" class="block font-mono text-xs font-bold uppercase tracking-widest text-text-main/60">
                    03. The Briefing
                </label>
                <div class="relative">
                    <textarea 
                        id="review" 
                        name="review" 
                        rows="4"
                        placeholder="What is the best seat? When does it get busy? Is the AC too cold?"
                        class="w-full p-4 bg-bg-main border-2 border-line rounded-sm font-body text-lg text-text-main placeholder:text-text-main/30 focus:outline-none focus:border-action focus:shadow-sm transition-all resize-none"
                        maxlength="500"
                    ></textarea>
                    <div class="text-right mt-2 font-mono text-[10px] text-text-main/40 uppercase" id="char-count">
                        500 characters remaining
                    </div>
                </div>
            </div>

            <!-- Submit Action -->
            <div class="pt-6">
                <button 
                    type="submit" 
                    id="submit-btn"
                    class="w-full md:w-auto px-12 py-4 bg-action text-action-fg font-mono font-bold uppercase tracking-widest text-sm shadow-[4px_4px_0px_0px_var(--color-ink)] hover:translate-x-[2px] hover:translate-y-[2px] hover:shadow-none transition-all duration-200 border-2 border-transparent hover:border-text-main disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Submit Report
                </button>
                <p class="text-center md:text-left mt-4 font-mono text-[10px] text-text-main/30 uppercase tracking-widest">
                    We manually verify every submission before listing.
                </p>
            </div>
        </form>

    </div>
</section>

<script is:inline>
    // Note: Astro View Transitions might re-run scripts, but simplistic approach here
    document.addEventListener('astro:page-load', () => {
        initForm();
    });
    // Fallback for initial load if not using view transitions or if it fails
    document.addEventListener('DOMContentLoaded', initForm);

    function initForm() {
        const form = document.getElementById('submit-form');
        if (!form) return; // Guard clause

        const linkInput = document.getElementById('maps-link');
        const linkIcon = document.getElementById('link-valid-icon');
        const reviewInput = document.getElementById('review');
        const charCount = document.getElementById('char-count');
        const successMessage = document.getElementById('success-message');
        const submitButton = document.getElementById('submit-btn');
        const resetButton = document.getElementById('reset-button');
        const maxLength = 500;

        // Validation Logic
        if (linkInput) {
            linkInput.addEventListener('input', (e) => {
                const val = e.target.value;
                if (val.includes('google.com/maps') || val.includes('goo.gl')) {
                    linkIcon?.classList.remove('opacity-0');
                    linkIcon?.classList.add('opacity-100');
                } else {
                    linkIcon?.classList.add('opacity-0');
                    linkIcon?.classList.remove('opacity-100');
                }
            });
        }

        if (reviewInput) {
            reviewInput.addEventListener('input', (e) => {
                const val = e.target.value;
                const remaining = maxLength - val.length;
                if (charCount) charCount.innerText = `${remaining} CHARACTERS REMAINING`;
            });
        }
        
        // Reset Logic
        if (resetButton) {
            resetButton.addEventListener('click', () => {
                form.reset();
                form.classList.remove('hidden');
                successMessage?.classList.add('hidden');
            });
        }

        // Submit Logic
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerText = "Transmitting...";
            }

            const formData = new FormData(form);
            const object = Object.fromEntries(formData);
            const json = JSON.stringify(object);
            
            // You should replace this with your actual Access Key injection method
            // For now, assuming it's hidden input or we append it if missing
            // object.access_key = '...'; 

            try {
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: json
                });
                
                const result = await response.json();

                if (response.status === 200) {
                    form.classList.add('hidden');
                    successMessage?.classList.remove('hidden');
                    // Scroll to message
                    document.getElementById('submit-spot')?.scrollIntoView({ behavior: 'smooth' });
                } else {
                    console.error(result);
                    alert("Transmission failed: " + result.message);
                }
            } catch (error) {
                console.error(error);
                alert("Something went wrong!");
            } finally {
                if (submitButton) {
                   submitButton.disabled = false;
                   submitButton.innerText = "Submit Report";
                }
            }
        });
    }
</script>
