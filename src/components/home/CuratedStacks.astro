---
import { getCollection } from 'astro:content';

const spots = (await getCollection('spots')).filter(spot => !!spot.data.coverImage?.image);

// 1. Calculate Top Neighborhoods
const neighborhoodCounts = spots.reduce((acc, spot) => {
    const hood = spot.data.neighborhood;
    acc[hood] = (acc[hood] || 0) + 1;
    return acc;
}, {} as Record<string, number>);

const topNeighborhoods = Object.entries(neighborhoodCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 3)
    .map(([name, count]) => ({
        label: name,
        desc: `${count} Locations`,
        href: `/neighborhoods/${name.toLowerCase().replace(/\s+/g, '-')}/`
    }));
---
<section class="py-24 px-4 lg:px-6 bg-bg-main border-b-2 border-dotted border-line">
    <div class="max-w-screen-xl mx-auto space-y-20">
        
        <!-- Section Heading -->
        <h2 class="font-display font-black text-4xl md:text-5xl text-text-main tracking-tight text-center">
            We Care About
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-12 lg:gap-24">
            
            <!-- Column 1: The Infrastructure (Power) -->
            <div class="flex flex-col items-start text-left space-y-8 h-full">
                <header class="w-full border-b-2 border-line-heavy pb-6">
                    <div class="font-display text-3xl font-bold">
                        The Infrastructure <span class="block text-text-main/40 font-normal text-xl mt-1">(Power)</span>
                    </div>
                </header>
                
                <div class="flex flex-col items-start flex-1 w-full">
                    <p class="font-body text-lg text-text-main/80 leading-relaxed mb-8">
                        A dead battery kills flow. We verify accessible outlets at every spot, ensuring you can push through the longest sessions without anxiety.
                    </p>
                    
                    <div class="mt-auto">
                        <a href="/spots/?plugs=true" class="group inline-flex items-center gap-2">
                            <span class="inline-block font-body font-bold text-xl text-text-main group-hover:text-action transition-colors border-b border-transparent group-hover:border-action">
                                Browse Power-Ready Spots
                            </span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Column 2: The Acoustics (Noise) -->
            <div class="flex flex-col items-start text-left space-y-8 h-full">
                <header class="w-full border-b-2 border-line-heavy pb-6">
                    <div class="font-display text-3xl font-bold">
                        The Acoustics <span class="block text-text-main/40 font-normal text-xl mt-1">(Noise)</span>
                    </div>
                </header>
                
                <div class="flex flex-col items-start flex-1 w-full">
                    <p class="font-body text-lg text-text-main/80 leading-relaxed mb-8">
                       From pin-drop silence to the energetic hum of an espresso machine. Choose the acoustic environment that matches your current deep work mode.
                    </p>
                    
                    <div class="flex items-center gap-6 mt-auto">
                        <a href="/spots/?noise=silence" class="group inline-flex items-center gap-2">
                            <span class="inline-block font-body font-bold text-xl text-text-main group-hover:text-action transition-colors border-b border-transparent group-hover:border-action">
                                Library
                            </span>
                        </a>
                        <span class="text-text-main/20">|</span>
                        <a href="/spots/?noise=hum" class="group inline-flex items-center gap-2">
                            <span class="inline-block font-body font-bold text-xl text-text-main group-hover:text-action transition-colors border-b border-transparent group-hover:border-action">
                                Cafe Buzz
                            </span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Column 3: The Territories (Neighborhoods) -->
            <div class="flex flex-col items-start text-left space-y-8 h-full">
                <header class="w-full border-b-2 border-line-heavy pb-6">
                    <div class="font-display text-3xl font-bold">
                        The Territories <span class="block text-text-main/40 font-normal text-xl mt-1">(Neighborhoods)</span>
                    </div>
                </header>
                
                <ul class="flex flex-col items-start space-y-8 flex-1 w-full">
                    {topNeighborhoods.map((item) => (
                        <li class="group w-full">
                            <a href={item.href} class="block transition-transform duration-300 ease-mechanical group-hover:translate-x-2">
                                <span class="inline-block font-body font-bold text-xl text-text-main group-hover:text-action transition-colors border-b border-transparent group-hover:border-action">
                                    {item.label}
                                </span>
                                <span class="block text-sm text-text-main/60 mt-2 leading-relaxed max-w-xs group-hover:text-text-main transition-colors">
                                    {item.desc}
                                </span>
                            </a>
                        </li>
                    ))}
                </ul>
            </div>

        </div>
    </div>
</section>
