---
import Layout from '../layouts/Layout.astro';
import MapInterface from '../components/react/MapInterface';
import { getCollection } from 'astro:content';

const spots = await getCollection('spots');

const mapSpots = spots.map(spot => ({
  id: spot.slug,
  name: spot.data.title,
  slug: spot.slug,
  lat: spot.data.metrics.coordinates.lat,
  lng: spot.data.metrics.coordinates.long,
  wifi: spot.data.metrics.wifi_speed,
  noise: spot.data.metrics.noise_level,
  power: spot.data.metrics.plug_access ? 'available' : 'none',
  score: spot.data.metrics.casi_score
}));

const seoTitle = "Intelligence Map";
const seoDescription = "Geospatial index of verified workspaces. Filter by signal strength and acoustic profile.";
---

<Layout title={seoTitle} description={seoDescription}>
    <main class="w-full h-[calc(100vh-64px)] overflow-hidden">
        <MapInterface client:only="react" spots={mapSpots} />
    </main>
</Layout>
